{{ 'announcement-bar.css' | asset_url | stylesheet_tag }}

{% liquid
  assign section_prefix_class = 'announcement-bar'
  assign section_scheme_class = section.settings.section_color_scheme | prepend: 'scheme scheme--'
  
  capture marquee_direction
    if section.settings.marquee_direction == 'marquee_forward'
      echo 'forward'
      else
        echo 'backward'
    endif
  endcapture
%}

{%- if section.settings.show_only_on_homepage == false or template.name == 'index' -%}
  <hideable-element>
    <aside
      id="{{ section_prefix_class }}-{{ section.id }}"
      class="{{ section_prefix_class }} {{ section_prefix_class }}-{{ section.id }} {{ section_scheme_class }} {% if section.settings.show_close_button %}close-btn-active{% endif %}"
      aria-label="{{ 'sections.announcement_bar.a11y.aria_label' | t }}"
    >
      <div class="container">
        <div class="{{ section_prefix_class }}_block-wrapper">
          {%- if section.settings.enable_timer -%}
            <div class="{{ section_prefix_class }}_countdown-timer" {{ section.shopify_attributes }}>
              {%- if section.settings.countdown_text != blank -%}
                <strong class="offer-text">{{ section.settings.countdown_text }}</strong>
              {%- endif -%}
              {%- render 'element-timer' | elem_timer_date: section.settings.end_date -%}
            </div>
          {%- endif -%}
          <marquee-component data-direction="{{ marquee_direction }}" data-pause-on-hover="{{ section.settings.marquee_on_hover }}" data-speed="{{ section.settings.marquee_speed }}">
            <div class="marquee-component">
              {%- for block in section.blocks -%}
                <div class="marquee-component_col">
                  {% if block.settings.heading != blank %}
                    <em class="{{ section_prefix_class }}_heading strong">{{ block.settings.heading }}</em>
                  {% endif %}
                  {% if block.settings.sub_heading != blank %}
                    <span class="{{ section_prefix_class }}_subheading strong">
                      {{- block.settings.sub_heading -}}
                    </span>
                  {% endif %}
                </div>
              {%- endfor -%}
            </div>
          </marquee-component>
          {%- if section.settings.show_close_button -%}
            <button
              type="button"
              class="{{ section_prefix_class }}_btn-close js-contents--btn-close"
              aria-label="{{ 'sections.announcement_bar.a11y.btn_close' | t }}"
              role="button"
            >
              <span class="visually-hidden">{{ 'sections.announcement_bar.a11y.btn_close' | t }}</span>
              {%- render 'icons-data', width: 14, height: 14, use_icon: true, icon_reference: 'cross' -%}
            </button>
          {%- endif -%}
        </div>
      </div>
    </aside>
  </hideable-element>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.announcement_bar.name",
  "limit": 1,
  "enabled_on": {
    "groups": [
      "header"
    ]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "show_only_on_homepage",
      "label": "t:sections.announcement_bar.settings.show_home_only.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "label": "t:sections.announcement_bar.settings.show_close_btn.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.common.count_timer.content"
    },
    {
      "type": "checkbox",
      "id": "enable_timer",
      "label": "t:sections.common.count_timer.label",
      "default": true
    },
    {
      "type": "text",
      "id": "countdown_text",
      "label": "t:sections.common.count_timer.count_timer_text.label",
      "default": "Limited-time offer!"
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "t:sections.common.count_timer.count_timer_end.label",
      "info": "t:sections.common.count_timer.count_timer_end.info",
      "default": "2025/04/05"
    },
    {
      "type": "inline_richtext",
      "id": "end_message",
      "label": "t:sections.common.count_timer.count_message.label",
      "info": "t:sections.common.count_timer.count_message.info"
    },
    {
      "type": "header",
      "content": "t:sections.common.scroll.content"
    },
    {
      "type": "range",
      "id": "marquee_speed",
      "label": "t:sections.common.scroll.settings.speed.label",
      "min": 1,
      "max": 30,
      "step": 1,
      "default": 20,
      "unit": "sec"
    },
    {
      "type": "select",
      "id": "marquee_direction",
      "label": "t:sections.common.scroll.settings.direction.label",
      "options": [
        {
          "value": "marquee_backward",
          "label": "t:sections.common.scroll.settings.direction.options.opt_1.label"
        },
        {
          "value": "marquee_forward",
          "label": "t:sections.common.scroll.settings.direction.options.opt_2.label"
        }
      ],
      "default": "marquee_backward"
    },
    {
      "type": "checkbox",
      "label": "t:sections.common.scroll.settings.on_hover.label",
      "id": "marquee_on_hover",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.common.style.content"
    },
    {
      "type": "color_scheme",
      "id": "section_color_scheme",
      "default": "scheme3",
      "label": "t:sections.common.clr_scheme.label"
    }
  ],
  "blocks": [
    {
      "name": "t:sections.announcement_bar.blocks.text.name",
      "type": "announcement_text",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.common.heading.label",
          "default": "Welcome to our store!"
        },
        {
          "type": "inline_richtext",
          "id": "sub_heading",
          "label": "t:sections.common.subheading.label",
          "default": "Explore Deals & Offers &nbsp; &nbsp; <a href='#'><em>SHOP NOW!</em></a>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.announcement_bar.name",
      "blocks": [
        {
          "type": "announcement_text"
        }
      ]
    }
  ]
}
{% endschema %}
