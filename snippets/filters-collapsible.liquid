{%- liquid
  assign sort_by = results.sort_by | default: results.default_sort_by
-%}
<filters-form data-preserver="true" class="filters-collapsible_form" data-section="{{ section.id }}" id="filters-collapsible_form" data-update-self="true">
  <form id="filters-form" class="--align-left">
    {% if filter_default %}
      <input
        id="Search-In-Template"
        type="hidden"
        name="q"
        value="{{ search.terms | escape }}"
      >
      <input name="options[prefix]" type="hidden" value="last">
    {% endif %}
    {% if section.settings.enable_sorting %}
      {%- liquid
        assign sort_by = results.sort_by | default: results.default_sort_by
        capture sort_value
          for option in results.sort_options
            if option.value == sort_by
              echo option.value
            endif
          endfor
        endcapture
      -%}
      <input id="sorting-input" type="hidden" name="sort_by" value="{{- sort_value -}}">
    {% endif %}
    <div class="filters-collapsible--mobile">
      <modal-component-toggler
        data-desktop-hidden="true"
      >
        <button
          type="button"
          data-expanded="false"
          data-modal-ref="modal-filters-vertical-drawer"
          aria-haspopup="dialog"
          aria-controls="{{ section.id }}-modal-filters-vertical-drawer"
          class="filters-sidebar_button"
        >
          <i class="fsh_icn">
            {%- render 'icons-data', width: 20, height: 20, use_icon: true, icon_reference: 'filters' -%}
          </i>
          {{ 'sections.products.facets.title' | t }}
        </button>
      </modal-component-toggler>
    </div>
    <modal-component
      data-modal="modal-filters-vertical-drawer"
      data-desktop-hidden="true"
      class="modal--filter"
    >
      <div
        class="modal --drawer modal-component modal-component--filters-vertical-drawer scheme--{{ section.settings.section_color_scheme }}"
        role="dialog"
        aria-modal="true"
        aria-labelledby="{{ section.id }}-modal-filters-vertical-drawer-heading"
        aria-describedby="{{ section.id }}-modal-filters-vertical-drawer"
        tabindex="-1"
      >
        <div class="modal-component_wrapper" id="{{ section.id }}-modal-filters-vertical-drawer">
          <div class="modal-component_body">
            <div class="filters-collapsible_wrapper">
              <header class="filters-collapsible_head">
                <i class="fsh_icn">
                  {%- render 'icons-data', width: 20, height: 20, use_icon: true, icon_reference: 'filters' -%}
                </i>
                <strong class="filters-collapsible_heading" id="{{ section.id }}-modal-filters-vertical-drawer-heading">{{- 'sections.products.facets.title' | t -}}</strong>
                <modal-component-toggler>
                  <button type="button"
                    data-expanded="true"
                    data-toggle-attribute="false"
                    data-modal-ref="modal-filters-vertical-drawer"
                    class="modal-component_btn-close"
                    data-desktop-hidden="true"
                  >
                    {%- render 'icons-data', width: 14, height: 14, use_icon: true, icon_reference: 'cross' -%}
                    <span class="visually-hidden">{{ 'accessibility.close' | t }}</span>
                  </button>
                </modal-component-toggler>
              </header>
              <div class="filters-collapsible_filters-wrapper">
                {%- for filter in results.filters -%}
                  {%- liquid
                    assign presentation = filter.presentation | default: default_presentation
                  -%}
                  {% case filter.type %}
                    {% when 'price_range' %}
                      {%- liquid
                        assign currencies_using_comma_decimals = 'ANG,ARS,BRL,BYN,BYR,CLF,CLP,COP,CRC,CZK,DKK,EUR,HRK,HUF,IDR,ISK,MZN,NOK,PLN,RON,RUB,SEK,TRY,UYU,VES,VND' | split: ','
                        assign uses_comma_decimals = false
                        if currencies_using_comma_decimals contains cart.currency.iso_code
                          assign uses_comma_decimals = true
                        endif
                        
                        assign max_price_amount = filter.range_max | money | strip_html | escape
                      -%}
                      {% if filter.range_max > 0 %}
                        {% assign accordion_prefix = 'filters-collapsible_accordion--' %}
                        <div class="filter-dropdown-wrapper">
                          <strong id="filterPriceBydropdown" class="visually-hidden">{{ 'sections.products.facets.price_range.label_by' | t }}</strong>
                          <dropdown-component data-sorting="true" data-input-id="sorting-input">
                            <button
                              type="button"
                              class="dropdown-component_opener --align-left"
                              aria-expanded="false"
                              aria-controls="filterpriceby"
                              aria-describedby="filterPriceBydropdown"
                            >
                              {{ filter.label | escape }}
                              <i class="dropdown-componenet_icn-caret">
                                {%- render 'icons-data', width: 9, height: 9, use_icon: true, icon_reference: 'caret-down' -%}
                              </i>
                            </button>
                            <div id="filterpriceby" class="dropdown-component_wrapper {{ accordion_prefix }}content collapsible-row_content--{{ filter.type }}">
                              <p data-range-text="update" class="mty fwc_text">{{ 'sections.products.facets.max_price' | t: price: max_price_amount }}</p>
                              <range-slider id="price-range" data-load="false">
                                <label class="visually-hidden" for="Filter-{{ filter.label | escape }}-{{ filter.min_value.param_name }}">
                                  {{ 'sections.products.facets.from' | t }}
                                </label>
                                <input
                                  id="Filter-{{ filter.label | escape }}-{{ filter.min_value.param_name }}"
                                  class="min"
                                  name="{{ filter.min_value.param_name }}"
                                  type="range"
                                  min="0"
                                  step="0.01"
                                  {% if filter.min_value.value %}
                                    {% if uses_comma_decimals %}
                                      value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                      {% else %}
                                        value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                                    {% endif %}
                                    {% else %}
                                      value="0"
                                  {% endif %}
                                  {% if uses_comma_decimals %}
                                    max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                    {% else %}
                                      max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                  {% endif %}
                                >
                                <label class="visually-hidden" for="Filter-{{ filter.label | escape }}-{{ filter.max_value.param_name }}">
                                  {{ 'sections.products.facets.to' | t }}
                                </label>
                                <input
                                  id="Filter-{{ filter.label | escape }}-{{ filter.max_value.param_name }}"
                                  class="max"
                                  name="{{ filter.max_value.param_name }}"
                                  type="range"
                                  min="0"
                                  step="0.01"
                                  {% if filter.max_value.value %}
                                    {% if uses_comma_decimals %}
                                      value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                      {% else %}
                                        value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                                    {% endif %}
                                    {% else %}
                                      {% if uses_comma_decimals %}
                                        value="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                        {% else %}
                                          value="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                      {% endif %}
                                  {% endif %}
                                  {% if uses_comma_decimals %}
                                    max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                    {% else %}
                                      max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                  {% endif %}
                                >
                                <div class="range_wrapper">
                                  <span class="range_min light left">
                                    {%- liquid
                                      if filter.min_value.value
                                        echo filter.min_value.value | money
                                        else
                                          echo 0 | money
                                      endif
                                    -%}
                                  </span>
                                  <span class="range_sep">
                                    {%- render 'icons-data', width: 8, height: 8, use_icon: true, icon_reference: 'minus' -%}
                                  </span>
                                  <span class="range_max light right">
                                    {%- liquid
                                      if filter.max_value.value
                                        if uses_comma_decimals
                                          echo filter.max_value.value | money
                                          else
                                            echo filter.max_value.value | money
                                        endif
                                        else
                                          if uses_comma_decimals
                                            echo filter.range_max | money
                                            else
                                              echo filter.range_max | money
                                          endif
                                      endif
                                    -%}
                                  </span>
                                </div>
                              </range-slider>
                            </div>
                          </dropdown-component>
                        </div>
                      {% endif %}
                    {% when 'boolean' or 'list' %}
                      {%- liquid
                        assign swatch_value = null
                        if value.swatch.image
                          assign image_url = value.swatch.image | image_url: width: 50
                          assign swatch_value = 'url(' | append: image_url | append: ')'
                          assign swatch_focal_point = value.swatch.image.presentation.focal_point
                          elsif value.swatch.color
                            assign swatch_value = 'rgb(' | append: value.swatch.color.rgb | append: ')'
                        endif
                      -%}
                      <div class="filter-dropdown-wrapper">
                        <strong id="filter{{ filter.label | replace: ' ', '' }}Bydropdown" class="visually-hidden">{{- filter.label -}}</strong>
                        <dropdown-component data-sorting="true" data-input-id="sorting-input">
                          <button
                            type="button"
                            class="dropdown-component_opener --align-left"
                            aria-expanded="false"
                            aria-controls="filter{{ filter.label | replace: ' ', '' }}by"
                            aria-describedby="filter{{ filter.label | replace: ' ', '' }}Bydropdown"
                          >
                            {{ filter.label | escape }}
                            <i class="dropdown-componenet_icn-caret">
                              {%- render 'icons-data', width: 9, height: 9, use_icon: true, icon_reference: 'caret-down' -%}
                            </i>
                          </button>
                          <div id="filter{{ filter.label | replace: ' ', '' }}by" class="dropdown-component_wrapper {{ accordion_prefix }}content collapsible-row_content--{{ filter.type }}">
                            <fieldset>
                              <legend class="visually-hidden">{{ filter.label | escape }}</legend>
                              <ul class="list-unstyled filter-widget_list filter-widget--update">
                                {%- for value in filter.values -%}
                                  <li>
                                    <input
                                      type="checkbox"
                                      class="form-control--resest"
                                      name="{{ value.param_name }}"
                                      value="{{ value.value }}"
                                      id="Filter-{{ filter.label | replace: ' ', '' | escape }}-{{ value.label | replace: ' ', '' }}"
                                      {% if value.active %}
                                        checked
                                      {% endif %}
                                      {% if value.count == 0 and value.active == false %}
                                        disabled
                                      {% endif %}
                                    >
                                    <label class="custom-form-label custom-form-label--checkbox" for="Filter-{{ filter.label | replace: ' ', '' | escape }}-{{ value.label | replace: ' ', '' }}">
                                      {%- if presentation == 'swatch' -%}
                                        <i class="cfl_icn-check cfl_icn-check--swatch" style="--swatch--background: {{ swatch_value }}; {% if swatch_focal_point %}--swatch-focal-point: {{ swatch_focal_point }};{% endif %}">
                                          {%- render 'icons-data', width: 10, height: 10, use_icon: true, icon_reference: 'check' -%}
                                        </i>
                                        {%- else -%}
                                          {%- if presentation == 'image' -%}
                                            <i class="cfl_icn-check cfl_icn-check--swatch  --image-active">
                                              {%- if value.image -%}
                                                {{- value.image | image_url: width: 300 | image_tag: class: '', alt: value.alt -}}
                                              {%- endif -%}
                                              {%- render 'icons-data', width: 10, height: 10, use_icon: true, icon_reference: 'check' -%}
                                            </i>
                                            {%- else -%}
                                              <i class="cfl_icn-check" {% if filter.label == 'Color' %} style="background-color: {{ value.label | escape | downcase }}; border-color: {{ value.label | escape | downcase }};" {% endif %}>
                                                {%- render 'icons-data', width: 10, height: 10, use_icon: true, icon_reference: 'check' -%}
                                              </i>
                                          {%- endif -%}
                                      {%- endif -%}
                                      {{ value.label | escape }} ({{ value.count }})
                                    </label>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </fieldset>
                          </div>
                        </dropdown-component>
                      </div>
                  {% endcase %}
                {%- endfor -%}
              </div>
            </div>
          </div>
        </div>
      </div>
    </modal-component>
    <div class="filters-collapsible_others-wrapper">
      {% if section.settings.enable_sorting %}
        <div class="filter-sort_wrapper">
          <div class="filter-dropdown-wrapper">
            <strong id="filtersSortBydropdown" class="visually-hidden">{{ 'sections.products.facets.sort_by_label' | t }}</strong>
            <dropdown-component data-sorting="true" data-input-id="sorting-input">
              <button
                type="button"
                class="dropdown-component_opener --align-left"
                aria-expanded="false"
                aria-controls="filterssortby"
                aria-describedby="filtersSortBydropdown"
              >
                {%- for option in results.sort_options -%}
                  {%- if option.value == sort_by -%}
                    {{ option.name | escape }}
                  {%- endif -%}
                {%- endfor -%}
                <i class="dropdown-componenet_icn-caret">
                  {%- render 'icons-data', width: 9, height: 9, use_icon: true, icon_reference: 'caret-down' -%}
                </i>
              </button>
              <div class="dropdown-component_wrapper">
                <ul id="filterssortby" class="list-unstyled select-dropdown--list">
                  {%- for option in results.sort_options -%}
                    <li>
                      <a role="button" href="#" class="dropdown-component_link dropdown-component_btn-sort {% if option.value == sort_by %}active{% endif %}" data-value="{{ option.value | escape }}">
                        {{ option.name | escape }}
                        {% if option.value == sort_by %}
                          <span class="visually-hidden">{{- 'sections.products.facets.option_selected' | t -}}</span>
                        {% endif %}
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            </dropdown-component>
          </div>
        </div>
      {% endif %}
      {% if results_counter != null %}
        <em class="filter-header_results-text">
          {% if results_counter > 0 %}
            {{ 'sections.search.show_results' | t: count: results_counter }}
            {% else %}
              {{ 'sections.search.no_res' | t }}
          {% endif %}
        </em>
        {% else %}
          <em class="filter-header_results-text">
            {% if results.products_count and results.products_count != results.all_products_count %}
              {{ 'sections.products.facets.product_count.other' | t: product_count: results.products_count, count: results.all_products_count }}
              {% else %}
                {{ 'sections.products.facets.product_count_simple.other' | t: count: results.all_products_count }}
            {% endif %}
          </em>
      {% endif %}
    </div>
  </form>
</filters-form>
