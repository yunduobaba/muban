{%- liquid
  assign sort_by = results.sort_by | default: results.default_sort_by
  if results.url
    assign results_url = results.url
  else
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
  endif
-%}

<header class="filters-head {{ color_scheme }}">
  <filters-form data-section="{{ section.id }}" {% unless section.settings.filter_type == 'vertical' %} data-update-id="filters-form" {% endunless %}>
    {%- assign active_filters = false -%}
    <form class="filters-head_wrapper">
      <div class="filters-header_active-wrapper">
        {% unless section.settings.filter_type == 'horizontal' %}
          <div class="filters-sidebar_button-wrap">
            <modal-component-toggler
              data-desktop-hidden="true"
            >
              <button
                type="button"
                data-expanded="false"
                data-modal-ref="modal-filters-horizontal-drawer"
                aria-haspopup="dialog"
                aria-controls="{{ section.id }}-modal-filters-horizontal-drawer"
                class="filters-sidebar_button"
              >
                <i class="fsh_icn">
                  {%- render 'icons-data', width: 20, height: 20, use_icon: true, icon_reference: 'filters' -%}
                </i>
                {{ 'sections.products.facets.title' | t }}
              </button>
            </modal-component-toggler>
          </div>
        {% endunless %}
        {%- for filter in results.filters -%}
          {%- for value in filter.active_values -%}
            {% assign active_filters = true %}
            <button-filter-remove data-for="Filter-{{ filter.label | escape }}-{{ value.label | replace: ' ', '' }}" {% unless section.settings.filter_type == 'vertical' %} data-update-id="filters-form" {% endunless %}>
              <button type="button" class="filters-head_btn-remove">
                {{ value.label | escape }}
                <i class="fhbr_icn-remove">
                  {%- render 'icons-data', width: 8, height: 8, use_icon: true, icon_reference: 'cross' -%}
                  <span class="visually-hidden">{{ 'sections.products.facets.clear_filter' | t }}</span>
                </i>
              </button>
            </button-filter-remove>
          {%- endfor -%}
          {% if filter.type == 'price_range' %}
            {%- if filter.min_value.value != null or filter.max_value.value != null -%}
              {% assign active_filters = true %}
              <button-filter-remove data-for="price-range" {% unless section.settings.filter_type == 'vertical' %} data-update-id="filters-form" {% endunless %}>
                <button type="button" class="filters-head_btn-remove">
                  {% if filter.min_value.value %}
                    {{ filter.min_value.value | money }}
                  {% else %}
                    {{ 0 | money }}
                  {% endif %}
                  -
                  {% if filter.max_value.value -%}
                    {{ filter.max_value.value | money }}
                  {% else %}
                    {{ filter.range_max | money }}
                  {% endif %}
                  <i class="fhbr_icn-remove">
                    {%- render 'icons-data', width: 8, height: 8, use_icon: true, icon_reference: 'cross' -%}
                    <span class="visually-hidden">{{ 'sections.products.facets.clear_filter' | t }}</span>
                  </i>
                </button>
              </button-filter-remove>
            {%- endif -%}
          {% endif %}
        {%- endfor -%}
        {% if active_filters %}
          <a href="{{ results_url }}" role="button" class="filters-form_remove-all ffrl_btn-link" aria-label="{{ 'sections.products.facets.clear_all_label' | t }}">{{ 'sections.products.facets.clear_all' | t }}</a>
        {% endif %}
      </div>
      {% unless section.settings.filter_type == 'horizontal' %}
        <div class="filters-head_others-wrapper">
          {% if section.settings.enable_sorting %}
            <div class="filter-sort_wrapper">
              <strong id="filtersSortBydropdown" class="visually-hidden">{{ 'sections.products.facets.sort_by_label' | t }}</strong>
              <dropdown-component data-sorting="true" data-input-id="sorting-input">
                <button
                  type="button"
                  class="dropdown-component_opener --align-left"
                  aria-expanded="false"
                  aria-controls="filterssortby"
                  aria-describedby="filtersSortBydropdown"
                >
                  {%- for option in results.sort_options -%}
                    {%- if option.value == sort_by -%}
                      {{ option.name | escape }}
                    {%- endif -%}
                  {%- endfor -%}
                  <i class="dropdown-componenet_icn-caret">
                    {%- render 'icons-data', width: 9, height: 9, use_icon: true, icon_reference: 'caret-down' -%}
                  </i>
                </button>
                <div class="dropdown-component_wrapper">
                  <ul id="filterssortby" class="list-unstyled select-dropdown--list">
                    {%- for option in results.sort_options -%}
                      <li>
                        <a role="button" href="#" class="dropdown-component_link dropdown-component_btn-sort {% if option.value == sort_by %}active{% endif %}" data-value="{{ option.value | escape }}">
                          {{ option.name | escape }}
                          {% if option.value == sort_by %}
                            <span class="visually-hidden">{{- 'sections.products.facets.option_selected' | t -}}</span>
                          {% endif %}
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
              </dropdown-component>
            </div>
          {% endif %}
          {% if results_counter != null %}
            <em class="filter-header_results-text">
              {% if results_counter > 0 %}
                {{ 'sections.search.show_results' | t: count: results_counter }}
                {% else %}
                  {{ 'sections.search.no_res' | t }}
              {% endif %}
            </em>
            {% else %}
              <em class="filter-header_results-text">
                {% if results.products_count and results.products_count != results.all_products_count %}
                  {{ 'sections.products.facets.product_count.other' | t: product_count: results.products_count, count: results.all_products_count }}
                  {% else %}
                    {{ 'sections.products.facets.product_count_simple.other' | t: count: results.all_products_count }}
                {% endif %}
              </em>
          {% endif %}
        </div>
      {% endunless %}
    </form>
  </filters-form>
</header>
