{{ 'cart-drawer.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign curr_currency = ''
  assign shop_currency = shop.currency
  for country in localization.available_countries
    if country.iso_code == localization.country.iso_code
      assign curr_currency = country.currency.iso_code
      break
    endif
  endfor
-%}
<modal-component
  data-modal="modal-cart-drawer"
  data-action="cart-drawer"
>
  <div
    class="modal modal-component --drawer modal-component--cart-drawer scheme--{{ settings.cart_draw_color_scheme }}"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modal-cart-drawer-heading"
    aria-describedby="modal-cart-drawer"
    tabindex="-1"
  >
    <div class="modal-component_wrapper" id="modal-cart-drawer">
      <modal-component-toggler>
        <button
          type="button"
          data-expanded="true"
          data-toggle-attribute="false"
          data-modal-ref="modal-cart-drawer"
          class="modal-component_btn-close"
        >
          {%- render 'icons-data', width: 14, height: 14, use_icon: true, icon_reference: 'cross' -%}
          <span class="visually-hidden">{{ 'accessibility.close' | t }}</span>
        </button>
      </modal-component-toggler>
      <div class="modal-component_body" id="cart-items">
        {%- if cart != empty -%}
          <div class="modal-component_head">
            <div class="showcase-popup_head">
              <strong id="modal-cart-drawer-heading" class="modal-component_heading">{{ 'sections.cart.title' | t }}</strong>
              {%- unless settings.cart_draw_welcome_message == blank -%}
                <strong class="cart-drawer_text-subtitle">
                  {{- settings.cart_draw_welcome_message -}}
                </strong>
              {%- endunless -%}
              {%- if settings.enable_free_shipping_message -%}
                <shipping-bar data-amount="{{ settings.free_shipping_amount }}" data-cart-totals="{{ cart.total_price }}" class="cart-free-shipping-box">
                  <span class="shipping-subtitle {{ head_scheme_class }}">
                    {{- settings.free_shipping_text -}}
                  </span>
                  <span class="free-shipping-progress" role="status">
                    <span style="width: 0%;" data-set="bar"></span>
                  </span>
                </shipping-bar>
              {%- endif -%}
            </div>
          </div>
          <div class="modal-component_content">
            {%- if cart != empty -%}
              {%- for item in cart.items -%}
                <cart-item-row class="cart-item-row" {% if template == 'cart' %} data-main-cart="true" {% endif %} data-id="{{ item.index | plus: 1 }}" data-variant-id="{{ item.id }}">
                  <div class="imgbox">
                    {%- if item.image != blank -%}
                      <img src="{{ item.image | image_url: width: 200 }}" width="200" height="200" loading="lazy" alt="">
                      {%- else -%}
                        {{- 'image' | placeholder_svg_tag: 'img--placeholder' -}}
                    {%- endif -%}
                  </div>
                  <div class="prod-holder">
                    {%- if settings.enable_cart_drawer_vendor -%}
                      <span class="vendor-text">
                        {{ item.product.vendor }}
                      </span>
                    {%- endif -%}
                    {%- render 'element-heading' | elem_heading_tag: 'strong' | elem_heading_parent: 'cart-drawer-item' | elem_heading_custom_class: 'cart-item-heading mty' | elem_heading_text: item.product.title | elem_heading_size: 'heading_x_small' | elem_heading_link: item.url -%}
                    <div class="price-holder">
                      {%- if item.original_line_price != item.final_line_price -%}
                        <span class="visually-hidden">
                          {{ 'sections.products.product.price.regular_price' | t }}
                        </span>
                        <s class="old-price">
                          {{- item.original_line_price | money -}}
                        </s>
                        <span class="visually-hidden">
                          {{ 'sections.products.product.price.sale_price' | t }}
                        </span>
                        <span class="price">
                          {{ item.final_line_price | money }}
                        </span>
                        {%- else -%}
                          <span class="price">
                            {{ item.final_line_price | money }}
                          </span>
                      {%- endif -%}
                      {%- if item.variant.available and item.unit_price_measurement -%}
                        <span class="unit-price caption">
                          <span class="visually-hidden">{{ 'sections.products.product.price.unit_price' | t }}</span>
                          {{ item.variant.unit_price | money }}
                          <span aria-hidden="true">/</span>
                          <span class="visually-hidden">&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span>
                          {%- if item.variant.unit_price_measurement.reference_value != 1 -%}
                            {{- item.variant.unit_price_measurement.reference_value -}}
                          {%- endif -%}
                          {{ item.variant.unit_price_measurement.reference_unit }}
                        </span>
                      {%- endif -%}
                    </div>
                    {%- if item.product.has_only_default_variant == false -%}
                      <ul class="list-unstyled mcdraw_options-list">
                        {%- for option in item.options_with_values -%}
                          <li>
                            <strong class="mcdraw_options-list_title">{{ option.name }}:</strong>
                            <strong class="mcdraw_options-list_value">
                                {{ option.value }}
                            </strong>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                    {%- for property in item.properties -%}
                      {%- assign property_first_char = property.first | slice: 0 -%}
                      {%- if property.last != blank and property_first_char != '_' -%}
                        <dl class="product-option">
                          <dt>{{ property.first }}:</dt>
                          <dd>
                            {%- if property.last contains '/uploads/' -%}
                              <a href="{{ property.last }}" class="link" target="_blank">
                                {{ property.last | split: '/' | last }}
                              </a>
                            {%- else -%}
                              {{ property.last }}
                            {%- endif -%}
                          </dd>
                        </dl>
                      {%- endif -%}
                    {%- endfor -%}
                    {%- if item.selling_plan_allocation != null -%}
                      <strong class="product_plan-description mty">{{ item.selling_plan_allocation.selling_plan.name }}</strong>
                    {%- endif -%}
                    <ul class="discounts list-unstyled">
                      {%- for discount in item.discounts -%}
                        <li>
                          {%- render 'icons-data', width: 11, height: 11, use_icon: true, icon_reference: 'discount' -%}
                          {{ discount.title }}
                        </li>
                      {%- endfor -%}
                    </ul>
                    <div class="quantity-holder">
                      <quantity-input class="quantity">
                        <label for="Quantity-{{ item.index | plus: 1 }}" class="visually-hidden">
                          {{- 'sections.products.product.quantity.label' | t -}} 
                        </label>
                        <button class="quantity_button {% if item.quantity < 2 %} disabled {% endif %}" name="minus" type="button" {% if item.quantity < 2 %} disabled="disabled" {% endif %}>
                          <span class="visually-hidden">
                            {{- 'sections.products.product.quantity.decrease' | t: product: item.title | escape -}}
                          </span>
                          {%- render 'icons-data', width: 8, height: 8, use_icon: true, icon_reference: 'minus' -%}
                        </button>
                        <input
                          class="quantity__input"
                          data-quantity-variant-id="{{ item.variant.id }}"
                          type="number"
                          name="updates[]"
                          value="{{ item.quantity }}"
                          {% # theme-check-disable %}
                          data-cart-quantity="{{ cart | item_count_for_variant: item.variant.id }}"
                          min="0"
                          {% if item.variant.quantity_rule.max != null %}
                            max="{{ item.variant.quantity_rule.max }}"
                          {% endif %}
                          step="{{ item.variant.quantity_rule.increment }}"
                          {% # theme-check-enable %}
                          aria-label="{{ 'sections.products.product.quantity.input_label' | t: product: item.title | escape }}"
                          id="Quantity-{{ item.index | plus: 1 }}"
                          data-index="{{ item.index | plus: 1 }}"
                        >
                        <button class="quantity_button" name="plus" type="button">
                          <span class="visually-hidden">
                            {{- 'sections.products.product.quantity.increase' | t: product: item.title | escape -}}
                          </span>
                          {%- render 'icons-data', width: 8, height: 8, use_icon: true, icon_reference: 'plus' -%}
                        </button>
                      </quantity-input>
                      <button type="button" class="cart-item--remove">
                        {%- render 'icons-data', width: 24, height: 24, use_icon: true, icon_reference: 'trash' -%}
                        <span class="visually-hidden">{{ 'sections.cart.remove_title' | t: title: item.title | escape }}</span>
                      </button>
                      <span class="--loader cart-drawer_loader">
                        <span class="visually-hidden">{{ 'accessibility.loading' | t }}</span>
                        <i class="ico-wrapper">
                          {%- render 'icons-data', width: 16, height: 16, use_icon: true, icon_reference: 'loader' -%}
                        </i>
                      </span>
                    </div>
                    <div class="cart-item-row--error hidden">
                      {% comment %} errors rendering here {% endcomment %}
                    </div>
                  </div>
                </cart-item-row>
              {%- endfor -%}
            {%- endif -%}
            {% if settings.cart_related_collection != null %}
              {%- if settings.cart_related_collection.all_products_count > 0 -%}
                {{ 'product-complementary-row.css' | asset_url | stylesheet_tag }}
                <div class="cart-drawer_related-wrapper">
                  {% if settings.cart_draw_related_heading != blank %}
                    <strong class="cart-drawer_rel-title">{{ settings.cart_draw_related_heading }}</strong>
                  {% endif %}
                  <splide-slider
                    data-drag='true'
                    data-autoplay='{{ settings.cart_auto_play }}'
                    data-pause-on-hover='true'
                    data-gap='15px'
                    data-per-move="1"
                    data-type="slide"
                    data-arrows='{{ settings.cart_show_navigation }}'
                    data-pagination='false'
                    data-per-page='1'
                    data-interval="{{ settings.cart_change_slides_every | times: 1000 }}"
                    {% unless slideshow_pagination_style == 'none' %}
                      data-pagination-style="{{ slideshow_pagination_style }}"
                    {% endunless %}
                  >
                    <div class="splide collection-slider cart-drawer-slider">
                      <div class="splide__track">
                        <div class="splide__list">
                          {%- liquid
                            assign collection_all_products_count = settings.cart_related_collection.products
                            assign products_to_show = settings.cart_related_max_to_show
                          -%}
                          {% for product in collection_all_products_count limit: products_to_show %}
                            <div class="splide__slide {{ section.id }}-{{ block.id }}">
                              <article class="product-complementary-row {{ section.id }}-{{ product.id }}">
                                {%- render 'product-column-row' block: block, product: product, row_index: forloop.index, prevent_btn: true -%}
                              </article>
                            </div>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                  </splide-slider>
                </div>
                {%- else -%}
                  <div class="cart-drawer_empty-collection --align-center">
                    <i class="cde_icn-wrap">
                      {%- render 'icons-data', width: 31, height: 31, use_icon: true, icon_reference: 'empty-cart' -%}
                    </i>
                    <strong class="h6 cde_heading" role="heading" aria-level="2">{{ 'sections.collection_products_grid.a11y.empty' | t }}</strong>
                  </div>
              {%- endif -%}
            {% endif %}
          </div>
          <div class="modal-component_foot">
            <div class="holder">
              <div class="total-holder">
                <span class="text">{{ 'sections.cart.subtotal' | t }}</span>
                <span class="price">{{ cart.total_price | money_with_currency }}</span>
              </div>
              <ul class="discounts list-unstyled" aria-label="{{ 'customer.order.discount' | t }}">
                {%- for discount in cart.cart_level_discount_applications -%}
                  <li class="discounts__discount discounts__discount--end">
                    {%- render 'icons-data', width: 11, height: 11, use_icon: true, icon_reference: 'discount' -%}
                    {{ discount.title }}
                    (-{{ discount.total_allocated_amount | money }})
                  </li>
                {%- endfor -%}
              </ul>
              <small class="tax-note caption-large rte">
                {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
                  {{ 'sections.cart.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
                {%- elsif cart.taxes_included -%}
                  {{ 'sections.cart.taxes_included_but_shipping_at_checkout' | t }}
                {%- elsif shop.shipping_policy.body != blank -%}
                  {{ 'sections.cart.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
                {%- else -%}
                  {{ 'sections.cart.taxes_and_shipping_at_checkout' | t }}
                {%- endif -%}
              </small>
              <div class="button-holder">
                <form action="{{ routes.cart_url }}" method="post">
                  {%- if settings.cart_min_order_value != blank -%}
                    <div data-contents="drawer-min-value-check">
                      <checkout-min
                        data-amount="{{- settings.cart_min_order_value -}}"
                        data-cart-totals="{{- cart.total_price -}}"
                      >
                        <button
                          type="submit"
                          class="button-top-checkout button button--primary"
                          name="checkout"
                        >
                          {{- 'sections.cart.checkout' | t -}}
                        </button>
                        <div class="mty cart-min-value">
                          <p>
                            {{- 'sections.cart.min_order_text' | t -}}
                          </p>
                        </div>
                      </checkout-min>
                    </div>
                    {%- else -%}
                      <button name="checkout" {% if cart.empty %}disabled{% endif %} type="submit" class="button-top-checkout button button--primary">{{ 'sections.cart.checkout' | t }}</button>
                  {%- endif -%}
                </form>
                <a href="{{ routes.cart_url }}" class="button-top-cart">{{ 'sections.cart.view' | t }}</a>
              </div>
            </div>
          </div>
          {%- else -%}
            <div class="modal-component_content">
              <div class="cart-drawer_empty">
                <div class="cart-drawer_empty-wrapper">
                  {%- render 'icons-data', width: 51, height: 51, use_icon: true, icon_reference: 'empty-cart' -%}
                  <span class="title d-block" id="modal-cart-drawer-heading">{{ 'sections.cart.empty' | t }}</span>
                  <a href="{{ routes.all_products_collection_url }}" class="button button--primary d-block">{{ 'sections.cart.continue_shopping' | t }}</a>
                  {%- if shop.customer_accounts_enabled -%}
                    {%- unless customer -%}
                      <span class="subtitle d-block">{{ 'sections.cart.login.title' | t }}</span>
                      <span class="subtext d-block">{{ 'sections.cart.login.paragraph_html' | t: link: routes.account_login_url }}</span>
                    {%- endunless -%}
                  {%- endif -%}
                </div>
              </div>
            </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</modal-component>